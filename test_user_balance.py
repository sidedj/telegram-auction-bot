#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –±–∞–ª–∞–Ω—Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
"""

import requests
import json
import time
import hashlib

def test_user_balance():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 476589798"""
    print("üß™ –¢–µ—Å—Ç –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 476589798")
    print("=" * 60)
    
    url = "https://web-production-fa7dc.up.railway.app/yoomoney"
    user_id = 476589798
    
    # –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ 50‚ÇΩ = 1 –ø—É–±–ª–∏–∫–∞—Ü–∏—è
    test_data = {
        'notification_type': 'p2p-incoming',
        'operation_id': f'balance_test_{int(time.time())}',
        'amount': '50.00',
        'withdraw_amount': '50.00',
        'currency': '643',
        'datetime': '2024-01-01T12:00:00.000Z',
        'sender': '41001000040',
        'codepro': 'false',
        'label': f'user_{user_id}',
        'test_notification': 'true'
    }
    
    # –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å
    sorted_keys = sorted(test_data.keys())
    string_to_sign = "&".join([f"{key}={test_data[key]}" for key in sorted_keys])
    signature = hashlib.sha1((string_to_sign + "SaTKEuJWPVXJI/JFpXDCHZ4q").encode('utf-8')).hexdigest()
    test_data['sha1_hash'] = signature
    
    print(f"üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ 50‚ÇΩ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
    print(f"üéØ –û–∂–∏–¥–∞–µ—Ç—Å—è: +1 –ø—É–±–ª–∏–∫–∞—Ü–∏—è")
    
    try:
        response = requests.post(url, data=test_data, timeout=30)
        
        print(f"üì• –°—Ç–∞—Ç—É—Å: {response.status_code}")
        print(f"üì• –û—Ç–≤–µ—Ç: {response.text}")
        
        if response.status_code == 200:
            print("‚úÖ Webhook: OK")
            print("\nüí° –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±–æ—Ç–µ:")
            print("   1. –ù–∞–∂–º–∏—Ç–µ 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'")
            print("   2. –ë–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 1 –ø—É–±–ª–∏–∫–∞—Ü–∏—é (–∏–ª–∏ ‚àû –¥–ª—è –∞–¥–º–∏–Ω–∞)")
            print("   3. –ù–∞–∂–º–∏—Ç–µ '–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å'")
            print("   4. –¢–∞–º —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å")
        else:
            print("‚ùå Webhook: –û—à–∏–±–∫–∞")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

def test_admin_balance():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    print("\nüîç –¢–µ—Å—Ç –±–∞–ª–∞–Ω—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
    print("=" * 60)
    
    print("üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 476589798 —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º")
    print("üí° –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è '‚àû (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)'")
    print("üí° –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è 0, —Ç–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –ª–æ–≥–∏–∫–æ–π –∞–¥–º–∏–Ω–æ–≤")

if __name__ == "__main__":
    print("üöÄ –¢–µ—Å—Ç –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("=" * 80)
    
    test_user_balance()
    test_admin_balance()
    
    print("\n" + "=" * 80)
    print("üéâ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")
    print("\nüí° –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0:")
    print("   1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º")
    print("   2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏")
    print("   3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–ª–∞–Ω—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö")
