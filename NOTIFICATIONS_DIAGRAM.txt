СИСТЕМА УВЕДОМЛЕНИЙ АУКЦИОННОГО БОТА
=====================================

┌─────────────────────────────────────────────────────────────────┐
│                        ПОЛЬЗОВАТЕЛЬ                            │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM BOT                                │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   Создание      │  │   Публикация    │  │   Завершение    │ │
│  │   аукциона      │  │   аукциона      │  │   аукциона      │ │
│  └─────────┬───────┘  └─────────┬───────┘  └─────────┬───────┘ │
└────────────┼────────────────────┼────────────────────┼─────────┘
             │                    │                    │
             ▼                    ▼                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                NOTIFICATION MANAGER                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   Уведомление   │  │   Уведомление   │  │   Уведомление   │ │
│  │   о создании    │  │   о публикации  │  │   о завершении  │ │
│  │   аукциона      │  │   аукциона      │  │   аукциона      │ │
│  └─────────┬───────┘  └─────────┬───────┘  └─────────┬───────┘ │
└────────────┼────────────────────┼────────────────────┼─────────┘
             │                    │                    │
             ▼                    ▼                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM API                                │
│                    (Отправка сообщений)                        │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                        ПОЛЬЗОВАТЕЛЬ                            │
│                    (Получение уведомлений)                     │
└─────────────────────────────────────────────────────────────────┘

WEBHOOK ИНТЕГРАЦИЯ
==================

┌─────────────────────────────────────────────────────────────────┐
│                        YOOMONEY                                │
│                    (Платежная система)                         │
└─────────────────────┬───────────────────────────────────────────┘
                      │ POST /yoomoney
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FLASK WEBHOOK                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. Получение данных платежа                             │   │
│  │ 2. Проверка подписи                                     │   │
│  │ 3. Определение количества публикаций                    │   │
│  │ 4. Обновление баланса в БД                              │   │
│  │ 5. Отправка уведомления о пополнении                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                NOTIFICATION MANAGER                            │
│              (Уведомление о пополнении баланса)                │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM API                                │
│                    (Отправка уведомления)                      │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                        ПОЛЬЗОВАТЕЛЬ                            │
│              (Получение уведомления о пополнении)              │
└─────────────────────────────────────────────────────────────────┘

ТИПЫ УВЕДОМЛЕНИЙ
================

1. ПОПОЛНЕНИЕ БАЛАНСА 💰
   ┌─────────────────────────────────────────────────────────────┐
   │ • Сумма пополнения                                         │
   │ • Количество публикаций                                    │
   │ • Новый баланс                                             │
   │ • Поздравление                                             │
   └─────────────────────────────────────────────────────────────┘

2. СОЗДАНИЕ АУКЦИОНА 🚀
   ┌─────────────────────────────────────────────────────────────┐
   │ • Описание товара                                          │
   │ • ID аукциона                                              │
   │ • Инструкции по публикации                                 │
   │ • Кнопка "Мои аукционы"                                    │
   └─────────────────────────────────────────────────────────────┘

3. ПУБЛИКАЦИЯ АУКЦИОНА 📢
   ┌─────────────────────────────────────────────────────────────┐
   │ • Описание товара                                          │
   │ • Ссылка на канал                                          │
   │ • Остаток публикаций                                       │
   │ • Информация о списании                                    │
   │ • Кнопки управления                                        │
   └─────────────────────────────────────────────────────────────┘

4. ЗАВЕРШЕНИЕ АУКЦИОНА 🏆
   ┌─────────────────────────────────────────────────────────────┐
   │ ДЛЯ ПРОДАВЦА:                                              │
   │ • Информация о продаже                                     │
   │ • Финальная цена                                           │
   │ • ID покупателя                                            │
   │                                                             │
   │ ДЛЯ ПОКУПАТЕЛЯ:                                            │
   │ • Поздравление с победой                                   │
   │ • Информация о лоте                                        │
   │ • Инструкции по завершению сделки                          │
   └─────────────────────────────────────────────────────────────┘

ОБРАБОТКА ОШИБОК
================

┌─────────────────────────────────────────────────────────────────┐
│                    ОШИБКА ОТПРАВКИ                             │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│ 1. Логирование ошибки                                          │
│ 2. Продолжение основного процесса                              │
│ 3. Пользователь получает основное сообщение                    │
│ 4. Уведомление не блокирует работу бота                        │
└─────────────────────────────────────────────────────────────────┘

ТЕСТИРОВАНИЕ
============

┌─────────────────────────────────────────────────────────────────┐
│ test_notifications.py                                          │
│ • Тест всех типов уведомлений                                  │
│ • Проверка корректности отправки                               │
│ • Отладочная информация                                        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ test_webhook_notifications.py                                  │
│ • Тест webhook уведомлений                                     │
│ • Проверка интеграции с YooMoney                               │
│ • Валидация подписей                                           │
└─────────────────────────────────────────────────────────────────┘
